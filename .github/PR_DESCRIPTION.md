# v1.1 Liminal Role Engine - Soft Launch Ready

## üåÄ English-Liminal v1.1 ‚Äî Liminal Role Engine (Soft Launch)

This PR introduces the complete v1.1 implementation of English-Liminal: a role-based English learning system powered by emotional engagement, liminal transitions, and social resonance.

### üéØ Philosophy

> "We don't teach language. We open new versions of you. Each scenario is a step into another life."

Instead of traditional testing, users embody roles (QA Engineer, Visa Applicant, Global Citizen, Parent Abroad) and progress through real-world scenarios with emotional feedback and social connection.

---

## üì¶ What's Included

### 1. Rust Core (Sprint 1-2: Core Integration)
**Files:** `core/src/roles.rs`, `core/src/storage.rs`, `core/src/api.rs`, `core/src/lib.rs`

#### New Types:
- **`RoleProgress`**: Tracks user progression through roles
  - `current_scene_index`, `total_scenes`, `coherence`
  - `emotion_tags: Vec<EmotionTag>`
  - `consecutive_days` (for consistency multiplier)
  - Methods: `complete_scene()`, `emotion_balance()`, `consistency_multiplier()`

- **`EmotionTag`**: Voice tone analysis
  - `tone`: "Calm", "Confident", "Nervous", "Uncertain"
  - `confidence: f32`
  - Methods: `color_hex()` ‚Üí #7ED321 (green), #F5A623 (amber), #4A90E2 (blue)
  - `wave_amplitude()` ‚Üí 3-8 (visual feedback intensity)

- **`ResonanceTrace` + `Reflection`**: Anonymous social sharing
  - Users can publish traces: "I passed the interview!"
  - Others can reflect: "You helped me", "I felt the same"
  - Powers the "Waves" social resonance screen

- **`LiminalTransition`**: 2.5s animations marking role milestones
  - Generated by `liminal_transition()` function
  - Color gradients (#4A90E2 ‚Üí #7ED321)
  - Contextual messages based on coherence level
  - Sound: `chime_gentle.mp3`

#### New Metrics:
```rust
RoleFlow = (completed_scenes / total_scenes) √ó consistency_multiplier
// consistency_multiplier: 0.8 (sporadic), 1.0 (daily), 1.2 (3-6 days), 1.5 (7+ days)

EmotionBalance = confident_count / (confident_count + nervous_count)

SocialEcho = traces_sent + reflections_received

JoyWave = spontaneous_returns + positive_emotion_tags
```

#### Storage (SQLite):
- `role_progress` table (id, role_id, current_scene_index, total_scenes, coherence, consecutive_days, timestamps)
- `emotion_tags` table (role_id, scene_id, tone, confidence, timestamp)
- `resonance_traces` table (id, role_id, scene_id, message, created_at)
- `reflections` table (trace_id, message, created_at)

#### FFI API (8 new functions):
1. `start_role_progress(role_id, total_scenes)` ‚Üí JSON
2. `complete_scene_with_emotion(role_id, scene_id, tone, confidence)` ‚Üí JSON
3. `get_role_progress_json(role_id)` ‚Üí JSON
4. `get_liminal_transition_json(role_id)` ‚Üí JSON
5. `update_consecutive_days(role_id, days)` ‚Üí JSON
6. `create_resonance_trace(trace_id, role_id, scene_id, message)` ‚Üí JSON
7. `add_reflection_to_trace(trace_id, message)` ‚Üí JSON
8. `get_recent_traces_json(role_id?, limit)` ‚Üí JSON

**Tests:** 13/13 passing (4 new v1.1 tests)

---

### 2. Content Library (Sprint 3: Content Forge)
**Files:** `content/roles/*/` (17 YAML files, 829 lines)

#### Role Tracks:

##### üîß QA Abroad (5 scenes)
- **qa-interview-01**: Tech interview, confident self-presentation
- **qa-bugreport-02**: Diplomatic bug reporting (urgent but respectful)
- **qa-standup-03**: Daily standup updates (brief and clear)
- **qa-review-04**: Polite disagreement in code reviews
- **qa-relax-05**: Weekend small talk (building team rapport)

**Target coherence:** 0.85 | **Duration:** 3 weeks

##### üõÇ Visa Journey (3 scenes)
- **visa-officer-01**: Consulate interview (clarity under pressure)
- **border-control-02**: Passport control (brief, respectful)
- **apartment-checkin-03**: First apartment abroad (practical questions)

**Target coherence:** 0.82 | **Duration:** 2 weeks

##### üåç Global Citizen (3 scenes)
- **airport-lounge-01**: Coffee ordering + small talk in transit
- **sim-card-02**: SIM card purchase (comparing plans)
- **job-hunt-03**: Recruiter screening call (professional enthusiasm)

**Target coherence:** 0.78 | **Duration:** 2 weeks

##### üë®‚Äçüë©‚Äçüëß Family Abroad (2 scenes)
- **pick-up-kid-kindergarten-01**: Parent-teacher check-in (warm engagement)
- **neighbours-chat-02**: Meeting neighbors (building community)

**Target coherence:** 0.75 | **Duration:** 1 week

#### YAML Structure:
```yaml
id: qa_interview_01
role_id: qa_engineer_abroad
difficulty: beginner | intermediate | advanced
emotion_wave: calm_confident
goals: ["Clear pronunciation", "Confident self-presentation"]
steps:
  - type: listen          # Listen to interviewer's question
  - type: speak_check     # Speak with reference text
  - type: apply_to_life   # Adapt to personal experience
rehearsal:
  decay_alpha: 0.84       # Memory retention curve
  next_ping_sec_min: 180  # Minimum rehearsal interval
coherence_weight: 0.15    # Contribution to RoleFlow
transition_message: "You've taken the first step into your role..."
```

---

### 3. Documentation
**Files:** `docs/V1.1_FLOW.md`

- Complete visual specification with ASCII flow diagrams
- Metric definitions (RoleFlow, JoyWave, SocialEcho, EmotionBalance)
- UI transition animations (2.5s duration, color gradients)
- 6-week sprint breakdown (Sprint 1-4)
- Emotional arc descriptions for each role track

---

## üß™ Test Results

```bash
cargo test --lib
# 13 tests passing:
# ‚úÖ test_role_progress
# ‚úÖ test_emotion_balance
# ‚úÖ test_liminal_transition
# ‚úÖ test_resonance_trace
# ‚úÖ (9 existing MVP tests)
```

---

## üìä Stats

- **Rust LOC:** +1,001 (roles.rs +270, storage.rs +476, api.rs +155, lib.rs +4)
- **Content:** 13 scenarios, 4 role tracks, ~6,000 words
- **YAML files:** 17 (13 scenes + 4 manifests)
- **New database tables:** 4 (role_progress, emotion_tags, resonance_traces, reflections)
- **FFI functions:** 8 new v1.1 APIs
- **Tests:** 13/13 passing

---

## üöÄ Next Steps (Sprint 4: UI Alchemy)

- [ ] Waves Screen ‚Äî visualize ResonanceTrace (pulsating waves)
- [ ] Liminal Transition Animation ‚Äî spiral ‚Üí sphere transitions
- [ ] Emotion Color Feedback ‚Äî real-time voice tone visualization
- [ ] Wave Amplitude Graph ‚Äî JoyWave engagement metrics
- [ ] Dashboard Metrics ‚Äî RoleFlow + EmotionBalance UI

---

## üé≠ The Liminal Vision

English-Liminal is not a language app. It's a liminal space where users shed their old identity and step into new roles. Each scenario is a threshold. Each transition is a transformation.

This PR delivers the core engine for that transformation‚Äîready for Soft Launch with 50 beta testers.

**"–ú—ã –Ω–µ —É—á–∏–º —è–∑—ã–∫—É. –ú—ã –æ—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ —Ç–µ–±—è."**
