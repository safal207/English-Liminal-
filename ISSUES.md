# ISSUES.md — Готовый бэклог для English-Liminal MVP

Структурированный список задач для создания 30-дневного MVP с волновой памятью и контекстными сценариями.

---

## Milestone 0 — Проект и каркас

### Issue 1 — Инициализация React Native (Expo)

**Описание:**
Создать базовый проект app/ с Expo и TypeScript, подключить необходимые библиотеки для работы с голосом, уведомлениями и хранением данных.

**Детали реализации:**
- [ ] Инициализировать Expo проект: `npx create-expo-app app --template`
- [ ] Настроить TypeScript конфигурацию
- [ ] Установить зависимости:
  - `expo-speech` (TTS)
  - `expo-av` (аудио запись)
  - `expo-notifications` (локальные уведомления)
  - `@react-native-async-storage/async-storage` (хранилище)
  - `js-yaml` (парсинг YAML)
  - `zod` (валидация схем)
- [ ] Настроить ESLint + Prettier
- [ ] Добавить Husky для pre-commit хуков

**Acceptance:**
- [ ] `pnpm expo start` успешно запускает проект
- [ ] Все библиотеки импортируются без ошибок
- [ ] TypeScript компилируется без warnings

**Тесты:**
- [ ] Проверить импорт всех зависимостей
- [ ] Запуск на iOS Simulator / Android Emulator

---

### Issue 2 — Структура экранов и навигация

**Описание:**
Создать базовую навигацию с tab-баром и заглушки для основных экранов приложения.

**Детали реализации:**
- [ ] Установить `@react-navigation/native` и зависимости
- [ ] Установить `@react-navigation/bottom-tabs`
- [ ] Создать экраны (заглушки):
  - `HomeScreen.tsx`
  - `WarmupScreen.tsx`
  - `PingScreen.tsx`
  - `RinseScreen.tsx`
  - `SettingsScreen.tsx`
- [ ] Настроить Bottom Tabs Navigator
- [ ] Добавить иконки для табов

**Acceptance:**
- [ ] Навигация между экранами работает
- [ ] Все экраны отображают базовую заглушку
- [ ] Tab-бар корректно отображается на iOS и Android

**Тесты:**
- [ ] Переключение между всеми табами
- [ ] Проверка состояния навигации

---

## Milestone 1 — Scripts Layer (YAML → движок)

### Issue 3 — Парсер YAML-сценариев

**Описание:**
Реализовать загрузку и валидацию YAML-сценариев с помощью js-yaml и zod.

**Детали реализации:**
- [ ] Создать `app/src/lib/scripts.ts`
- [ ] Определить TypeScript типы для сценариев
- [ ] Реализовать функцию `loadScript(id: string): Script`
- [ ] Валидация схемы через zod:
  - `id`, `title`
  - `context_triggers`
  - `steps[]` (listen, speak_check, contrast, apply_to_life)
  - `rehearsal` (decay_alpha, next_ping_sec_min/max)
- [ ] Кэширование загруженных сценариев в памяти
- [ ] Функция `listAvailableScripts(): ScriptMeta[]`

**Acceptance:**
- [ ] Загрузка `morning-warmup-01.yaml` возвращает валидный объект
- [ ] Невалидный YAML выбрасывает понятную ошибку
- [ ] Список сценариев корректно возвращается

**Тесты:**
- [ ] Юнит-тест: загрузка валидного YAML
- [ ] Юнит-тест: ошибка при невалидной схеме
- [ ] Юнит-тест: кэширование работает

---

### Issue 4 — Исполнитель шагов (step runner)

**Описание:**
Создать React hook для управления прохождением шагов сценария.

**Детали реализации:**
- [ ] Создать `app/src/hooks/useScriptRunner.ts`
- [ ] Интерфейс хука:
  ```typescript
  useScriptRunner(scriptId: string) => {
    currentStep: Step | null,
    stepIndex: number,
    progress: number, // 0-100%
    next(): void,
    prev(): void,
    reset(): void,
    isComplete: boolean
  }
  ```
- [ ] Логика переключения шагов
- [ ] Вычисление прогресса
- [ ] Сохранение состояния сессии

**Acceptance:**
- [ ] Демо-сценарий проходит по всем шагам
- [ ] Прогресс корректно отображается
- [ ] Переходы next/prev работают корректно

**Тесты:**
- [ ] Юнит-тест: инициализация с валидным scriptId
- [ ] Юнит-тест: переход между шагами
- [ ] Юнит-тест: завершение сценария

---

## Milestone 2 — Голос и оценка произношения (простая)

### Issue 5 — TTS (прослушай и повтори)

**Описание:**
Компонент для воспроизведения текста через expo-speech с возможностью паузы и повтора.

**Детали реализации:**
- [ ] Создать `app/src/components/TTSButton.tsx`
- [ ] Интеграция с `expo-speech`
- [ ] Состояния: idle, playing, paused
- [ ] UI: иконка play/pause, визуальный индикатор
- [ ] Поддержка очереди фраз (опционально)

**Acceptance:**
- [ ] Фраза из YAML воспроизводится
- [ ] Возможность паузы и возобновления
- [ ] Повтор фразы работает корректно

**Тесты:**
- [ ] Мануальный: воспроизведение различных фраз
- [ ] Мануальный: пауза/возобновление

---

### Issue 6 — Запись и простая оценка речи

**Описание:**
Компонент для записи голоса пользователя и базовой оценки произношения через текстовое сравнение.

**Детали реализации:**
- [ ] Создать `app/src/components/Recorder.tsx`
- [ ] Интеграция с `expo-av` для записи
- [ ] UI: кнопка записи, визуальный индикатор
- [ ] MVP-оценка: Levenshtein distance для сравнения текстов
- [ ] Функция `calculateScore(userText: string, refText: string): number`
- [ ] Возврат score (0-100) и одной подсказки

**Acceptance:**
- [ ] Запись голоса работает
- [ ] Ввод распознанного текста (MVP: вручную)
- [ ] Score рассчитывается корректно
- [ ] Одна короткая подсказка возвращается

**Тесты:**
- [ ] Юнит-тест: Levenshtein distance
- [ ] Мануальный: запись и оценка

---

## Milestone 3 — Утро/Пинг/Вечер: UX-потоки

### Issue 7 — WarmupScreen (3 минуты)

**Описание:**
Экран утреннего разогрева с последовательностью шагов: listen → speak_check → contrast → apply_to_life.

**Детали реализации:**
- [ ] Использовать `useScriptRunner` для управления шагами
- [ ] Таймер 03:00 с обратным отсчётом
- [ ] Прогресс-бар для отображения текущего шага
- [ ] Рендер компонентов для каждого типа шага:
  - `ListenStep` (TTS)
  - `SpeakCheckStep` (Recorder)
  - `ContrastStep` (выбор варианта)
  - `ApplyToLifeStep` (голос/текст)
- [ ] Отображение одной подсказки по фонемам (текстовая)
- [ ] Завершение → переход к summary

**Acceptance:**
- [ ] Полный цикл `morning-warmup-01.yaml` проходится за ≤3:30
- [ ] Все типы шагов корректно отображаются
- [ ] Таймер и прогресс работают

**Тесты:**
- [ ] Мануальный: полный проход сценария
- [ ] Проверка корректности UI для каждого типа шага

---

### Issue 8 — PingScreen (60 секунд контекст-пинг)

**Описание:**
Экран для быстрой микро-практики: показать карточку с фразой, пользователь повторяет, получает оценку и одну правку.

**Детали реализации:**
- [ ] Карточка с микро-сценой (1 фраза + контекст)
- [ ] Быстрый цикл: слушай → повтори → оценка
- [ ] Таймер 60 секунд
- [ ] Кнопка «Сказал в реальности» (Use-in-Wild)
- [ ] Сохранение метки Use-in-Wild в AsyncStorage
- [ ] Одна короткая правка/подсказка

**Acceptance:**
- [ ] Прохождение пинга за ≤60 сек
- [ ] Отметка «сказал в реальности» сохраняется
- [ ] Быстрый цикл работает плавно

**Тесты:**
- [ ] Мануальный: полный цикл пинга
- [ ] Проверка сохранения Use-in-Wild метки

---

### Issue 9 — RinseScreen (вечер: 1 фраза дня, 1 ошибка, 1 успех)

**Описание:**
Вечерний экран рефлексии: фраза дня, что улучшить, что получилось.

**Детали реализации:**
- [ ] Поле «Фраза дня» (автоподбор из недавних шагов)
- [ ] Поле «Одно улучшение» (текст/голос)
- [ ] Поле «Что зашло» (текст/голос)
- [ ] Сохранение в локальный дневник (AsyncStorage)
- [ ] На следующий день: фраза дня подтягивается в Warmup для повтора

**Acceptance:**
- [ ] Все поля корректно сохраняются
- [ ] Фраза дня на следующий день появляется в Warmup
- [ ] Интерфейс интуитивен и быстр

**Тесты:**
- [ ] Мануальный: заполнение и сохранение
- [ ] Проверка подтягивания фразы на следующий день

---

## Milestone 4 — Память-волна (затухание и пинги)

### Issue 10 — Модель "retention-wave"

**Описание:**
Реализовать модель волновой памяти для фраз: затухание амплитуды, планировщик повторов.

**Детали реализации:**
- [ ] Создать `app/src/lib/retention.ts`
- [ ] Тип `MemoryLink`:
  ```typescript
  {
    phrase: string,
    lastSeen: number,        // timestamp
    wave: number,            // 0..1 (амплитуда)
    decayAlpha: number,      // 0.7..0.9
  }
  ```
- [ ] Функция `updateWave(link: MemoryLink, outcome: 'success' | 'fail')`
- [ ] Функция `scheduleNextPing(link: MemoryLink): number` (timestamp)
- [ ] Планировщик: чем ниже wave, тем выше шанс показа
- [ ] Защита от спама (минимальный интервал между пингами)

**Acceptance:**
- [ ] История фраз накапливается локально
- [ ] Пинги приходят в «реалистичном» темпе
- [ ] Wave корректно затухает при неудаче

**Тесты:**
- [ ] Юнит-тест: updateWave для success/fail
- [ ] Юнит-тест: scheduleNextPing возвращает корректный timestamp
- [ ] Симуляция: 10 фраз, 30 дней

---

### Issue 11 — Уведомления

**Описание:**
Локальные уведомления по расписанию (утро/день/вечер) с deep-link на нужный экран.

**Детали реализации:**
- [ ] Интеграция с `expo-notifications`
- [ ] Запрос разрешений у пользователя
- [ ] Создание уведомлений:
  - Утро: Warmup
  - День: Ping
  - Вечер: Rinse
- [ ] Deep-linking: нотификация → конкретный экран
- [ ] Настройки времени уведомлений в SettingsScreen

**Acceptance:**
- [ ] Уведомления приходят в заданное время
- [ ] Тап по уведомлению открывает нужный экран
- [ ] Пользователь может настроить время

**Тесты:**
- [ ] Мануальный: получение уведомления
- [ ] Мануальный: deep-link работает

---

## Milestone 5 — Данные и аналитика

### Issue 12 — AsyncStorage: события и прогресс

**Описание:**
Модель хранения событий и прогресса пользователя.

**Детали реализации:**
- [ ] Создать `app/src/lib/storage.ts`
- [ ] Модель событий:
  ```typescript
  UserEvent {
    type: 'step_done' | 'said_in_wild' | 'score',
    timestamp: number,
    scriptId: string,
    stepIndex: number,
    data: any, // score, phrase, etc.
  }
  ```
- [ ] Модель дневного саммари:
  ```typescript
  DailySummary {
    date: string,
    streak: number,
    avgScore: number,
    useInWildCount: number,
  }
  ```
- [ ] Функции для добавления событий и получения статистики
- [ ] Экран статистики в SettingsScreen или отдельный таб

**Acceptance:**
- [ ] События сохраняются корректно
- [ ] Статистика отображается: streak, avg score, use-in-wild
- [ ] График за последние 7 дней (простая линия)

**Тесты:**
- [ ] Юнит-тест: добавление события
- [ ] Юнит-тест: расчёт streak
- [ ] Мануальный: отображение статистики

---

### Issue 13 — Мини-телеметрия (локальная, без сервера)

**Описание:**
Сбор локальных метрик для анализа: длительность шагов, отказы, предпочтения.

**Детали реализации:**
- [ ] Логирование:
  - Длительность каждого шага
  - Отказ от шага (skip)
  - Предпочитаемые типы шагов
- [ ] JSON-лог в AsyncStorage
- [ ] Кнопка в Settings: «Export logs» → share JSON

**Acceptance:**
- [ ] Лог накапливается локально
- [ ] Export logs работает
- [ ] JSON-лог корректно форматирован

**Тесты:**
- [ ] Мануальный: проверка экспорта логов

---

## Milestone 6 — Контент

### Issue 14 — Добавить 5 YAML-сцен

**Описание:**
Создать 5 сценариев для различных жизненных контекстов.

**Детали реализации:**
- [ ] `morning-warmup-01.yaml` (уже есть)
- [ ] `cafe-to-go-01.yaml` (заказ кофе навынос)
- [ ] `elevator-smalltalk-01.yaml` (small talk в лифте)
- [ ] `standup-update-01.yaml` (статус на stand-up)
- [ ] `pick-up-kid-kindergarten-01.yaml` (забрать ребёнка из садика)
- [ ] Валидация всех сценариев через zod

**Acceptance:**
- [ ] Все 5 сценариев валидны
- [ ] Каждый сценарий проходит через step runner
- [ ] Контент релевантен и реалистичен

**Тесты:**
- [ ] Мануальный: проход каждого сценария
- [ ] Валидация схемы для каждого YAML

---

### Issue 15 — Семейный режим (2 минуты с детьми)

**Описание:**
Специальные сценарии для занятий с детьми: короткие, с эмодзи/иконками.

**Детали реализации:**
- [ ] Тоггл в Settings: «Семейный режим»
- [ ] Создать 2-3 детских сценария:
  - `family-bedtime-story-01.yaml`
  - `family-animal-sounds-01.yaml`
- [ ] Отдельная вкладка «Family» в навигации (если режим включён)
- [ ] Упрощённый UI с большими иконками/эмодзи

**Acceptance:**
- [ ] Семейный режим включается/выключается
- [ ] Вкладка «Family» появляется при включении режима
- [ ] Детские сценарии работают корректно

**Тесты:**
- [ ] Мануальный: включение режима
- [ ] Мануальный: проход детского сценария

---

## Дополнительные задачи (опционально)

### Issue 16 — Onboarding Flow
- Приветственный экран
- Выбор целей (работа, путешествия, семья)
- Настройка расписания

### Issue 17 — Dark Mode
- Поддержка тёмной темы
- Переключение в Settings

### Issue 18 — Offline Mode
- Полная работа без интернета
- Синхронизация при подключении (будущее)

### Issue 19 — Shareable Results
- Поделиться успехом (screenshot streak)
- Export прогресса в PDF

### Issue 20 — A/B Testing Infrastructure
- Простой механизм для тестирования вариантов UI
- Локальное логирование результатов

---

## Acceptance-критерии для релиза MVP (суммарно)

- [x] Утренний сценарий полностью проходим за 3-4 минуты
- [x] Ping-сцена ≤60 сек, с 1 правкой и отметкой «сказал в реальности»
- [x] Вечерний RINSE сохраняет «фразу дня» и «одно улучшение»
- [x] Локальные уведомления приходят утром/днём/вечером и ведут в правильный экран
- [x] YAML-контент валидируется, 5 сцен поставляются из коробки
- [x] Локальная «волна» снижает частоту показа уже «закреплённых» фраз

---

## Приоритизация

**P0 (Must Have для MVP):**
- Issue 1-9 (Milestone 0-3)
- Issue 14 (5 YAML-сцен)

**P1 (Should Have):**
- Issue 10-11 (Память-волна, уведомления)
- Issue 12 (Статистика)

**P2 (Nice to Have):**
- Issue 13 (Телеметрия)
- Issue 15 (Семейный режим)
- Issue 16-20 (Дополнительные фичи)

---

**Следующий шаг:** Начать с Issue 1 → инициализация Expo проекта и установка зависимостей.
